<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module SilverwebEcom::ControllerExtensions::SiteControllerExtensions::InstanceMethods - RDoc Documentation</title>

<link href="../../../fonts.css" rel="stylesheet">
<link href="../../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../../";
</script>

<script src="../../../js/jquery.js"></script>
<script src="../../../js/navigation.js"></script>
<script src="../../../js/search_index.js"></script>
<script src="../../../js/search.js"></script>
<script src="../../../js/searcher.js"></script>
<script src="../../../js/darkfish.js"></script>


<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../../table_of_contents.html#pages">Pages</a>
    <a href="../../../table_of_contents.html#classes">Classes</a>
    <a href="../../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-add_to_cart">#add_to_cart</a>
    
    <li ><a href="#method-i-cart_update">#cart_update</a>
    
    <li ><a href="#method-i-check_out">#check_out</a>
    
    <li ><a href="#method-i-decrement_cart_item">#decrement_cart_item</a>
    
    <li ><a href="#method-i-delete_cart_item">#delete_cart_item</a>
    
    <li ><a href="#method-i-empty_cart">#empty_cart</a>
    
    <li ><a href="#method-i-empty_cart_no_redirect">#empty_cart_no_redirect</a>
    
    <li ><a href="#method-i-get_cart_contents">#get_cart_contents</a>
    
    <li ><a href="#method-i-get_cart_summary_body">#get_cart_summary_body</a>
    
    <li ><a href="#method-i-get_shopping_cart_info">#get_shopping_cart_info</a>
    
    <li ><a href="#method-i-get_shopping_cart_item_info">#get_shopping_cart_item_info</a>
    
    <li ><a href="#method-i-get_sizes_for_color">#get_sizes_for_color</a>
    
    <li ><a href="#method-i-hide_cart">#hide_cart</a>
    
    <li ><a href="#method-i-increment_cart_item">#increment_cart_item</a>
    
    <li ><a href="#method-i-live_product_search">#live_product_search</a>
    
    <li ><a href="#method-i-load_product_style_slider">#load_product_style_slider</a>
    
    <li ><a href="#method-i-product_detail">#product_detail</a>
    
    <li ><a href="#method-i-product_index_feed">#product_index_feed</a>
    
    <li ><a href="#method-i-retailers">#retailers</a>
    
    <li ><a href="#method-i-save_order">#save_order</a>
    
    <li ><a href="#method-i-show_cart">#show_cart</a>
    
    <li ><a href="#method-i-show_products">#show_products</a>
    
    <li ><a href="#method-i-toggle_cart">#toggle_cart</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-SilverwebEcom::ControllerExtensions::SiteControllerExtensions::InstanceMethods">
  <h1 id="module-SilverwebEcom::ControllerExtensions::SiteControllerExtensions::InstanceMethods" class="module">
    module SilverwebEcom::ControllerExtensions::SiteControllerExtensions::InstanceMethods
  </h1>

  <section class="description">
    
  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-add_to_cart" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_to_cart</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Shopping <a href="../../../Cart.html">Cart</a></p>
          
          

          
          <div class="method-source-code" id="add_to_cart-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 331</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_to_cart</span>
  <span class="ruby-comment"># user =  User.find_by_id(session[:user_id])</span>

  <span class="ruby-ivar">@cart</span> = <span class="ruby-constant">Cart</span>.<span class="ruby-identifier">get_cart</span>(<span class="ruby-string">&#39;cart&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:session_id</span>], <span class="ruby-identifier">session</span>[<span class="ruby-value">:user_id</span>])

  <span class="ruby-comment">#    @cart = Cart.get_cart(session[:cart])</span>
  <span class="ruby-comment">#    session[:cart] = @cart.id</span>
  <span class="ruby-comment">#  puts(&quot;cart id: #{@cart.id}&quot;)</span>

  <span class="ruby-ivar">@product_detail</span> = <span class="ruby-constant">ProductDetail</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">product_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>], <span class="ruby-identifier">color</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:color</span>], <span class="ruby-identifier">size</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:size</span>]).<span class="ruby-identifier">first</span>
  <span class="ruby-comment"># puts(&quot;Product in Add: #{@product_detail.product.inspect}&quot;)</span>
  <span class="ruby-comment">#  puts(&quot;Product Detail In Add: #{@product_detail.inspect}&quot;)</span>
  <span class="ruby-comment"># inventory_item_description = params.map {|k,vs| vs.map {|v| &quot;#{k}:#{v}&quot;}}.join(&quot;,&quot;)</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-ivar">@current_item</span> = <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">add_product</span>(<span class="ruby-ivar">@product_detail</span>.<span class="ruby-identifier">product</span>, <span class="ruby-ivar">@product_detail</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:quantity</span>])
    <span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;Quantity Ordered: #{@current_item.quantity.inspect}&quot;</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@current_item</span>.<span class="ruby-identifier">quantity</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@product_detail</span>.<span class="ruby-identifier">units_in_stock</span>
      <span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;cart quantity:#{@current_item.quantity}, unit in stock: #{@product_detail.units_in_stock}&quot;</span>)
      <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-value">:warning</span>] = <span class="ruby-string">&#39;Your request exceeds current inventory, your quantity has been reduced to what we have in stock.&#39;</span>
      <span class="ruby-comment"># @current_item.quantity = @product_detail.units_in_stock.to_i</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-ivar">@flash_message</span> = <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-value">:warning</span>]
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
    <span class="ruby-ivar">@flash_message</span> = <span class="ruby-string">&#39;That product is currently unavailable.&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> { <span class="ruby-identifier">head</span> <span class="ruby-value">:ok</span> }
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> {  <span class="ruby-identifier">render</span> <span class="ruby-identifier">plain</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@flash_message</span> }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-cart_update" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cart_update</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="cart_update-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 546</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">cart_update</span>
  <span class="ruby-identifier">find_cart</span>

  <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">coupon_code</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:cart</span>][<span class="ruby-value">:coupon_code</span>]
  <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">save</span>

  <span class="ruby-identifier">puts</span>(<span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">inspect</span>)

  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">json</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">message</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span> } }
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">head</span> <span class="ruby-value">:ok</span> }
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># render :text=&gt;params[:cart][:coupon_code]</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-check_out" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">check_out</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>check out</p>
          
          

          
          <div class="method-source-code" id="check_out-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 312</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">check_out</span>
  <span class="ruby-identifier">find_cart</span>

  <span class="ruby-ivar">@shipping_methods</span> = <span class="ruby-constant">Settings</span>.<span class="ruby-identifier">shipping_methods</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> [[<span class="ruby-string">&#39;Ground&#39;</span>, <span class="ruby-value">0</span>], [<span class="ruby-string">&#39;2 Day&#39;</span>, <span class="ruby-value">1</span>], [<span class="ruby-string">&#39;Next Day&#39;</span>, <span class="ruby-value">2</span>], [<span class="ruby-string">&#39;Pick Up Store&#39;</span>, <span class="ruby-value">3</span>]] <span class="ruby-operator">:</span> <span class="ruby-constant">Settings</span>.<span class="ruby-identifier">shipping_methods</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">map</span>.<span class="ruby-identifier">with_index</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">element</span>,<span class="ruby-identifier">i</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">element</span>,<span class="ruby-identifier">i</span>]}
  
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">items</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;site&#39;</span>, <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;index&#39;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment"># @cart.hide</span>
    <span class="ruby-comment"># @cart.set_shipping(@cart.calc_shipping)</span>
    <span class="ruby-comment"># @order = Order.new</span>

  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-decrement_cart_item" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">decrement_cart_item</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="decrement_cart_item-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 451</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">decrement_cart_item</span>
  <span class="ruby-identifier">find_cart</span>
  <span class="ruby-ivar">@current_item_counter</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:current_item</span>]
  <span class="ruby-ivar">@current_item</span> = <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">items</span>[<span class="ruby-ivar">@current_item_counter</span>.<span class="ruby-identifier">to_i</span>]
  <span class="ruby-ivar">@current_item</span>.<span class="ruby-identifier">decrement_quantity</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@current_item</span>.<span class="ruby-identifier">quantity</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
    <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">items</span>.<span class="ruby-identifier">delete_at</span>(<span class="ruby-ivar">@current_item_counter</span>.<span class="ruby-identifier">to_i</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> { <span class="ruby-identifier">head</span> <span class="ruby-value">:ok</span> }
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">head</span> <span class="ruby-value">:ok</span> }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-delete_cart_item" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_cart_item</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="delete_cart_item-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 467</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_cart_item</span>
  <span class="ruby-identifier">find_cart</span>
  <span class="ruby-ivar">@current_item_counter</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:current_item</span>]
  <span class="ruby-ivar">@current_item</span> = <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">items</span>.<span class="ruby-identifier">delete_at</span>(<span class="ruby-ivar">@current_item_counter</span>.<span class="ruby-identifier">to_i</span>)
  <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">save</span>

  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> { <span class="ruby-identifier">head</span> <span class="ruby-value">:ok</span> }
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">head</span> <span class="ruby-value">:ok</span> }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-empty_cart" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">empty_cart</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="empty_cart-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 486</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">empty_cart</span>
  <span class="ruby-identifier">find_cart</span>
  <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">delete</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:cart</span>] = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">find_cart</span>

  <span class="ruby-comment">#    head :ok</span>

  <span class="ruby-comment">#    redirect_to_index</span>

  <span class="ruby-comment">#        find_cart</span>
  <span class="ruby-comment">#    @cart=nil</span>
  <span class="ruby-comment">#    session[:cart] = nil</span>

  <span class="ruby-identifier">redirect</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:redirect</span>].<span class="ruby-identifier">blank?</span>
               <span class="ruby-node">%w[site index]</span>
             <span class="ruby-keyword">else</span>
               <span class="ruby-identifier">params</span>[<span class="ruby-value">:redirect</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;:&#39;</span>)
             <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">redirect_to_hash</span> = {}.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">params</span>.<span class="ruby-identifier">permit!</span>.<span class="ruby-identifier">to_h</span>).<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-identifier">redirect</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-identifier">redirect</span>[<span class="ruby-value">1</span>])
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">xhr?</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">redirect_to_hash</span>) }
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">save_order</span>
    <span class="ruby-identifier">$hostfull</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">protocol</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">host_with_port</span>

    <span class="ruby-identifier">session</span>[<span class="ruby-value">:mainnav_status</span>] = <span class="ruby-keyword">false</span>

    <span class="ruby-ivar">@order</span> = <span class="ruby-constant">Order</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:order</span>])
    <span class="ruby-ivar">@order</span>.<span class="ruby-identifier">add_line_items_from_cart</span>(<span class="ruby-ivar">@cart</span>, <span class="ruby-identifier">$hostfull</span>)
    <span class="ruby-ivar">@order</span>.<span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:user_id</span>])
    <span class="ruby-ivar">@order</span>.<span class="ruby-identifier">ip_address</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>
    <span class="ruby-ivar">@order</span>.<span class="ruby-identifier">email</span> = <span class="ruby-ivar">@order</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">name</span>
    <span class="ruby-ivar">@order</span>.<span class="ruby-identifier">cart_type</span> = <span class="ruby-string">&#39;CreditCard&#39;</span>

    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@order</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-identifier">return_response</span> = <span class="ruby-ivar">@order</span>.<span class="ruby-identifier">purchase</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">return_response</span>.<span class="ruby-identifier">success?</span>
        <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-string">&#39;Thank you for your Order!!&#39;</span>
        <span class="ruby-identifier">session</span>[<span class="ruby-value">:cart</span>] = <span class="ruby-keyword">nil</span>
        <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-value">:success</span>, <span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;orders&#39;</span>, <span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@order</span>.<span class="ruby-identifier">id</span>)
        <span class="ruby-comment">#     redirect_to( :action =&gt; :customer_detail, :controller=&gt;&quot;orders&quot;, :id=&gt;@order.id)</span>

      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-string">&#39;Transaction failed! &lt;br&gt; &lt;br&gt; &lt;br&gt;&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">return_response</span>.<span class="ruby-identifier">message</span>
        <span class="ruby-identifier">render</span> <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;checkoutcc&#39;</span>

      <span class="ruby-keyword">end</span>

      <span class="ruby-comment">#        session[:cart] = nil</span>
      <span class="ruby-comment">#    redirect_to_index(&quot;Thank you for your order&quot;)</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">render</span> <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;checkoutcc&#39;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-empty_cart_no_redirect" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">empty_cart_no_redirect</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="empty_cart_no_redirect-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 479</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">empty_cart_no_redirect</span>
  <span class="ruby-identifier">find_cart</span>
  <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">delete</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:cart</span>] = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">find_cart</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_cart_contents" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_cart_contents</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_cart_contents-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 413</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_cart_contents</span>
  <span class="ruby-identifier">find_cart</span>
  <span class="ruby-ivar">@checkout_cart</span> = <span class="ruby-ivar">@cart</span>
  <span class="ruby-identifier">render</span> <span class="ruby-identifier">partial</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;checkout_cart_item&#39;</span>, <span class="ruby-identifier">collection</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@checkout_cart</span>.<span class="ruby-identifier">items</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_cart_summary_body" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_cart_summary_body</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_cart_summary_body-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 406</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_cart_summary_body</span>
  <span class="ruby-identifier">summary_partial</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:summary_template</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;/site/cart_summary_body.html&#39;</span>
  <span class="ruby-identifier">find_cart</span>
  <span class="ruby-ivar">@checkout_cart</span> = <span class="ruby-ivar">@cart</span>
  <span class="ruby-identifier">render</span> <span class="ruby-identifier">partial</span><span class="ruby-operator">:</span> <span class="ruby-identifier">summary_partial</span>, <span class="ruby-identifier">locals</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">checkout_cart</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@checkout_cart</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_shopping_cart_info" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_shopping_cart_info</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_shopping_cart_info-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 419</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_shopping_cart_info</span>
  <span class="ruby-identifier">find_cart</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:small</span>]
    <span class="ruby-identifier">render</span> <span class="ruby-identifier">partial</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;/site/shopping_cart_small_info.html&#39;</span>

  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">render</span> <span class="ruby-identifier">partial</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;/site/shopping_cart_info.html&#39;</span>

  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_shopping_cart_item_info" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_shopping_cart_item_info</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_shopping_cart_item_info-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 400</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_shopping_cart_item_info</span>
  <span class="ruby-identifier">find_cart</span>
  <span class="ruby-ivar">@checkout_cart_item</span> = <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">items</span>[<span class="ruby-identifier">params</span>[<span class="ruby-value">:item_no</span>].<span class="ruby-identifier">to_i</span>]
  <span class="ruby-identifier">render</span> <span class="ruby-identifier">partial</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;/site/shopping_cart_item_info.html&#39;</span>, <span class="ruby-identifier">locals</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">checkout_cart_item</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@checkout_cart_item</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_sizes_for_color" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_sizes_for_color</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_sizes_for_color-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 217</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_sizes_for_color</span>
  <span class="ruby-ivar">@product</span> = <span class="ruby-constant">Product</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])

  <span class="ruby-ivar">@product_sizes</span> = <span class="ruby-keyword">begin</span>
                     <span class="ruby-ivar">@product</span>.<span class="ruby-identifier">product_details</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&#39;distinct `size`, `units_in_stock`&#39;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;`color` = &#39;#{params[:color]}&#39;&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">sku_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>) <span class="ruby-operator">||</span> [{ <span class="ruby-identifier">size</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;N/S&#39;</span>, <span class="ruby-identifier">units_in_stock</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;0&#39;</span> }]
                   <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
                     [{ <span class="ruby-identifier">size</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;N/S&#39;</span>, <span class="ruby-identifier">units_in_stock</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;0&#39;</span> }]
                   <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#    @product_sizes = @product.product_details.select(&quot;distinct `size`, `units_in_stock`&quot;).where(&quot;`color` = &#39;#{params[:color]}&#39;&quot;)  || [{:size=&gt;&#39;n/a&#39;, :units_in_stock=&gt;&quot;0&quot;}]</span>
  <span class="ruby-comment"># .map(&amp;:to_i).sort</span>
  <span class="ruby-ivar">@product_size_array</span> = <span class="ruby-ivar">@product_sizes</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:size</span>)
  <span class="ruby-identifier">render</span> <span class="ruby-identifier">partial</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;sizes_list.html&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-hide_cart" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">hide_cart</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="hide_cart-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 363</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">hide_cart</span>
  <span class="ruby-identifier">find_cart</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">visable</span>
    <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">hide</span>
    <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">xhr?</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;store&#39;</span>, <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;store_list&#39;</span> }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-increment_cart_item" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">increment_cart_item</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="increment_cart_item-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 430</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">increment_cart_item</span>
  <span class="ruby-identifier">find_cart</span>
  <span class="ruby-ivar">@current_item_counter</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:current_item</span>]
  <span class="ruby-ivar">@current_item</span> = <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">items</span>[<span class="ruby-ivar">@current_item_counter</span>.<span class="ruby-identifier">to_i</span>]
  <span class="ruby-ivar">@current_item</span>.<span class="ruby-identifier">increment_quantity</span>
  <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">save</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@current_item</span>.<span class="ruby-identifier">quantity</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@current_item</span>.<span class="ruby-identifier">product_detail</span>.<span class="ruby-identifier">units_in_stock</span>
    <span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;cart quantity:#{@current_item.quantity}, unit in stock: #{@current_item.product_detail.units_in_stock}&quot;</span>)
    <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-value">:warning</span>] = <span class="ruby-string">&#39;Your request exceeds current inventory, your quantity has been reduced to what we have in stock.&#39;</span>
    <span class="ruby-comment"># @current_item.quantity = @product_detail.units_in_stock.to_i</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@flash_message</span> = <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-value">:warning</span>]

  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> { <span class="ruby-identifier">head</span> <span class="ruby-value">:ok</span> }
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> {  <span class="ruby-identifier">render</span> <span class="ruby-identifier">plain</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@flash_message</span> } 
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-live_product_search" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">live_product_search</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="live_product_search-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 146</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">live_product_search</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:mainnav_status</span>] = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:last_catetory</span>] = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">&#39;REQUEST_URI&#39;</span>]
  <span class="ruby-ivar">@page_name</span> = <span class="ruby-keyword">begin</span>
               <span class="ruby-constant">Menu</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:parent_menu_id</span>]).<span class="ruby-identifier">name</span>
             <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
               <span class="ruby-string">&#39;&#39;</span>
             <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@products_per_page</span> = <span class="ruby-constant">Settings</span>.<span class="ruby-identifier">search_products_per_page</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-value">8</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Settings</span>.<span class="ruby-identifier">search_products_per_page</span>.<span class="ruby-identifier">to_i</span>
  <span class="ruby-ivar">@category_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:category_id</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-ivar">@department_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:department_id</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-ivar">@category_children</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:category_children</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword">false</span>

  <span class="ruby-ivar">@search</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:search</span>]

  <span class="ruby-identifier">session</span>[<span class="ruby-value">:search</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:search</span>].<span class="ruby-identifier">strip</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:search</span>]

  <span class="ruby-ivar">@history</span> = (<span class="ruby-identifier">session</span>[<span class="ruby-value">:history</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;[Nothing...]&#39;</span>).<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;:,:&#39;</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@history</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:search</span>]) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:search</span>].<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">session</span>[<span class="ruby-value">:history</span>] = <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">session</span>[<span class="ruby-value">:history</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:history</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">session</span>[<span class="ruby-value">:search</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;:,:&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:search</span>])
    <span class="ruby-ivar">@history</span> = (<span class="ruby-identifier">session</span>[<span class="ruby-value">:history</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;[Nothing...]&#39;</span>).<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;:,:&#39;</span>)
    <span class="ruby-ivar">@history</span> = <span class="ruby-ivar">@history</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">10</span>] <span class="ruby-keyword">if</span> <span class="ruby-ivar">@history</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span>
    <span class="ruby-identifier">session</span>[<span class="ruby-value">:history</span>] = <span class="ruby-ivar">@history</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;:,:&#39;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@products</span> = <span class="ruby-constant">Product</span>.<span class="ruby-identifier">by_search_term</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:search</span>])

  <span class="ruby-comment"># @products = Product.find_products_search(params[:page], session[:search])</span>

  <span class="ruby-ivar">@product_count</span> = <span class="ruby-ivar">@products</span>.<span class="ruby-identifier">length</span>

  <span class="ruby-ivar">@products</span> = <span class="ruby-constant">Kaminari</span>.<span class="ruby-identifier">paginate_array</span>(<span class="ruby-ivar">@products</span>).<span class="ruby-identifier">page</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>]).<span class="ruby-identifier">per</span>(<span class="ruby-ivar">@products_per_page</span>)

  <span class="ruby-ivar">@product_first</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;1&#39;</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">*</span> <span class="ruby-ivar">@products_per_page</span> <span class="ruby-operator">-</span> (<span class="ruby-ivar">@products_per_page</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>))

  <span class="ruby-ivar">@product_last</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@products</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">:</span> ((<span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">*</span> <span class="ruby-ivar">@products_per_page</span>) <span class="ruby-operator">-</span> <span class="ruby-ivar">@products_per_page</span>) <span class="ruby-operator">+</span> <span class="ruby-ivar">@products</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@products</span>.<span class="ruby-identifier">length</span>

  <span class="ruby-identifier">search_action_template</span> = <span class="ruby-keyword">begin</span>
                             (<span class="ruby-constant">Settings</span>.<span class="ruby-identifier">search_template_name</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;show_products_search&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;show_products_search-&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-constant">Settings</span>.<span class="ruby-identifier">product_list_template_name</span>)
                           <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
                             <span class="ruby-string">&#39;show_products_search&#39;</span>
                           <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@action_template</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:template</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">search_action_template</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:template</span>]

  <span class="ruby-ivar">@java_script_custom</span> = <span class="ruby-keyword">begin</span>
                          <span class="ruby-ivar">@action_template</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;show_products_search&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@action_template</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;.js&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>
                        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
                          <span class="ruby-string">&#39;&#39;</span>
                        <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@style_sheet_custom</span> = <span class="ruby-keyword">begin</span>
                          <span class="ruby-ivar">@action_template</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;show_products_search&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@action_template</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;.css&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>
                        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
                          <span class="ruby-string">&#39;&#39;</span>
                        <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:search</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">xhr?</span>
    <span class="ruby-identifier">render</span> <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;show_products_search&#39;</span>
  <span class="ruby-keyword">else</span>

    <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@action_template</span> }
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@action_template</span> }
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">xml</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@products</span> }
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">json</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@products</span> }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#    head :ok</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-load_product_style_slider" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">load_product_style_slider</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="load_product_style_slider-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 561</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">load_product_style_slider</span>
  <span class="ruby-identifier">render</span> <span class="ruby-identifier">partial</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;/site_includes/load_product_style_slider.html&#39;</span>, <span class="ruby-identifier">locals</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">blah</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;test&#39;</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-product_detail" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">product_detail</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="product_detail-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 231</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">product_detail</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:mainnav_status</span>] = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@product</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>].<span class="ruby-identifier">blank?</span>
               <span class="ruby-constant">Product</span>.<span class="ruby-identifier">first</span>
             <span class="ruby-keyword">else</span>
               <span class="ruby-constant">Product</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
             <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:next</span>]
    <span class="ruby-ivar">@product</span> = <span class="ruby-ivar">@product</span>.<span class="ruby-identifier">next_in_collection</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-string">&#39;=======NEXT========&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:prev</span>]
    <span class="ruby-ivar">@product</span> = <span class="ruby-ivar">@product</span>.<span class="ruby-identifier">previous_in_collection</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-string">&#39;=======PREV=======&#39;</span>

  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">session</span>[<span class="ruby-value">:parent_menu_id</span>] = <span class="ruby-value">0</span>

  <span class="ruby-ivar">@page_template</span> = <span class="ruby-operator">!</span><span class="ruby-ivar">@product</span>.<span class="ruby-identifier">custom_layout</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;product_detail-&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@product</span>.<span class="ruby-identifier">custom_layout</span> <span class="ruby-operator">:</span> (<span class="ruby-keyword">begin</span>
                                                                                                         <span class="ruby-string">&#39;product_detail-&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-constant">Settings</span>.<span class="ruby-identifier">product_template_name</span>
                                                                                                       <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
                                                                                                         <span class="ruby-string">&#39;product_detail&#39;</span>
                                                                                                       <span class="ruby-keyword">end</span>) <span class="ruby-keyword">rescue</span> <span class="ruby-string">&#39;product_detail&#39;</span>

  <span class="ruby-ivar">@java_script_custom</span> = <span class="ruby-keyword">begin</span>
                          <span class="ruby-ivar">@page_template</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;product_detail&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@page_template</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;.js&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>
                        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
                          <span class="ruby-string">&#39;&#39;</span>
                        <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@style_sheet_custom</span> = <span class="ruby-keyword">begin</span>
                          <span class="ruby-ivar">@page_template</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;product_detail&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@page_template</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;.css&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>
                        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
                          <span class="ruby-string">&#39;&#39;</span>
                        <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@page_name</span> = <span class="ruby-keyword">begin</span>
                 <span class="ruby-ivar">@product</span>.<span class="ruby-identifier">product_name</span>
               <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
                 <span class="ruby-string">&quot;&#39;Home&#39; not found!!&quot;</span>
               <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@collection_product_list</span> = <span class="ruby-constant">Product</span>.<span class="ruby-identifier">all</span>
  <span class="ruby-ivar">@pictures</span> = <span class="ruby-ivar">@product</span>.<span class="ruby-identifier">pictures</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">active_flag</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>)

  <span class="ruby-ivar">@sizing_page</span> = <span class="ruby-keyword">begin</span>
                   <span class="ruby-constant">Page</span>.<span class="ruby-identifier">find_by_title</span>(<span class="ruby-ivar">@product</span>.<span class="ruby-identifier">sheet_name</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39; Sizing&#39;</span>)
                 <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
                   <span class="ruby-string">&#39;&#39;</span>
                 <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@care_page</span> = <span class="ruby-keyword">begin</span>
                 <span class="ruby-constant">Page</span>.<span class="ruby-identifier">find_by_title</span>(<span class="ruby-ivar">@product</span>.<span class="ruby-identifier">sheet_name</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39; Care&#39;</span>)
               <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
                 <span class="ruby-string">&#39;&#39;</span>
               <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@product_details</span> = <span class="ruby-ivar">@product</span>.<span class="ruby-identifier">product_details</span>
  <span class="ruby-ivar">@product_colors</span> = <span class="ruby-keyword">begin</span>
                      <span class="ruby-ivar">@product_details</span>.<span class="ruby-identifier">group</span>(<span class="ruby-value">:color</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">sku_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>) <span class="ruby-operator">||</span> [{ <span class="ruby-identifier">size</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;N/C&#39;</span> }]
                    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
                      [{ <span class="ruby-identifier">size</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;N/C&#39;</span> }]
                    <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@product_sizes</span> = <span class="ruby-keyword">begin</span>
                     <span class="ruby-ivar">@product_details</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&#39;distinct `size`, `units_in_stock`&#39;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;`color` = &#39;#{@product_colors[0].color}&#39;&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">sku_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>) <span class="ruby-operator">||</span> [{ <span class="ruby-identifier">size</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;N/S&#39;</span>, <span class="ruby-identifier">units_in_stock</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;0&#39;</span> }]
                   <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
                     [{ <span class="ruby-identifier">size</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;N/S&#39;</span>, <span class="ruby-identifier">units_in_stock</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;0&#39;</span> }]
                   <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@product_size_array</span> = <span class="ruby-ivar">@product_sizes</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:size</span>)

  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@page_template</span> } <span class="ruby-comment"># show.html.erb</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">xml</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@page</span> }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-product_index_feed" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">product_index_feed</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="product_index_feed-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 574</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">product_index_feed</span>
  <span class="ruby-ivar">@google_taxonomy</span> = <span class="ruby-string">&#39;Apparel &amp; Accessories &gt; Clothing &gt; Swimwear&#39;</span>
  <span class="ruby-ivar">@full_url_path</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">protocol</span> <span class="ruby-operator">+</span>  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">host_with_port</span>
  <span class="ruby-ivar">@products</span> = <span class="ruby-constant">Product</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">product_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-retailers" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">retailers</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="retailers-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 565</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">retailers</span>
  <span class="ruby-ivar">@retailers</span> = <span class="ruby-constant">Retailer</span>.<span class="ruby-identifier">all</span>

  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment"># index.html.erb</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-save_order" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">save_order</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="save_order-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 512</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save_order</span>
  <span class="ruby-identifier">$hostfull</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">protocol</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">host_with_port</span>

  <span class="ruby-identifier">session</span>[<span class="ruby-value">:mainnav_status</span>] = <span class="ruby-keyword">false</span>

  <span class="ruby-ivar">@order</span> = <span class="ruby-constant">Order</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:order</span>])
  <span class="ruby-ivar">@order</span>.<span class="ruby-identifier">add_line_items_from_cart</span>(<span class="ruby-ivar">@cart</span>, <span class="ruby-identifier">$hostfull</span>)
  <span class="ruby-ivar">@order</span>.<span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:user_id</span>])
  <span class="ruby-ivar">@order</span>.<span class="ruby-identifier">ip_address</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>
  <span class="ruby-ivar">@order</span>.<span class="ruby-identifier">email</span> = <span class="ruby-ivar">@order</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">name</span>
  <span class="ruby-ivar">@order</span>.<span class="ruby-identifier">cart_type</span> = <span class="ruby-string">&#39;CreditCard&#39;</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@order</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-identifier">return_response</span> = <span class="ruby-ivar">@order</span>.<span class="ruby-identifier">purchase</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">return_response</span>.<span class="ruby-identifier">success?</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-string">&#39;Thank you for your Order!!&#39;</span>
      <span class="ruby-identifier">session</span>[<span class="ruby-value">:cart</span>] = <span class="ruby-keyword">nil</span>
      <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-value">:success</span>, <span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;orders&#39;</span>, <span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@order</span>.<span class="ruby-identifier">id</span>)
      <span class="ruby-comment">#     redirect_to( :action =&gt; :customer_detail, :controller=&gt;&quot;orders&quot;, :id=&gt;@order.id)</span>

    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-string">&#39;Transaction failed! &lt;br&gt; &lt;br&gt; &lt;br&gt;&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">return_response</span>.<span class="ruby-identifier">message</span>
      <span class="ruby-identifier">render</span> <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;checkoutcc&#39;</span>

    <span class="ruby-keyword">end</span>

    <span class="ruby-comment">#        session[:cart] = nil</span>
    <span class="ruby-comment">#    redirect_to_index(&quot;Thank you for your order&quot;)</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">render</span> <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;checkoutcc&#39;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-show_cart" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">show_cart</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="show_cart-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 374</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">show_cart</span>
  <span class="ruby-comment">#  user =  User.find_by_id(session[:user_id])</span>

  <span class="ruby-comment"># @cart = (session[:cart] ||= Cart.new)</span>
  <span class="ruby-ivar">@cart</span> = <span class="ruby-constant">Cart</span>.<span class="ruby-identifier">get_cart</span>(<span class="ruby-string">&#39;cart&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:session_id</span>], <span class="ruby-identifier">session</span>[<span class="ruby-value">:user_id</span>])
  <span class="ruby-comment">#   @cart = Cart.get_cart(session[:cart])</span>
  <span class="ruby-comment">#    puts(&quot;cart id: #{@cart.id}&quot;)</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">visable</span>
    <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">show</span>
    <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">xhr?</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-show_products" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">show_products</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>before_action :find_cart, :except =&gt; :empty_cart</p>
          
          

          
          <div class="method-source-code" id="show_products-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 43</span>
       <span class="ruby-keyword">def</span> <span class="ruby-identifier">show_products</span>
         <span class="ruby-identifier">puts</span>(<span class="ruby-string">&#39;in show products...&#39;</span>)
         <span class="ruby-identifier">session</span>[<span class="ruby-value">:mainnav_status</span>] = <span class="ruby-keyword">false</span>
         <span class="ruby-identifier">session</span>[<span class="ruby-value">:last_catetory</span>] = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">&#39;REQUEST_URI&#39;</span>]
         <span class="ruby-ivar">@page_name</span> = <span class="ruby-keyword">begin</span>
                      <span class="ruby-constant">Menu</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:parent_menu_id</span>]).<span class="ruby-identifier">name</span>
                    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
                      <span class="ruby-string">&#39;&#39;</span>
                    <span class="ruby-keyword">end</span>
         <span class="ruby-ivar">@page_name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:department_id</span>].<span class="ruby-identifier">to_s</span>
         <span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;---------@page_name=&gt; &#39;#{@page_name}&#39;&quot;</span>)

         <span class="ruby-ivar">@page_info</span> = <span class="ruby-constant">Page</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page_name</span>]).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>  .<span class="ruby-identifier">dup</span>
         <span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;---------the page=&gt; #{@page_info.inspect}&quot;</span>)
         <span class="ruby-ivar">@products_per_page</span> = <span class="ruby-constant">Settings</span>.<span class="ruby-identifier">products_per_page</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span>  <span class="ruby-value">8</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Settings</span>.<span class="ruby-identifier">products_per_page</span>.<span class="ruby-identifier">to_i</span>
         <span class="ruby-ivar">@category_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:category_id</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>.<span class="ruby-identifier">dup</span>
         <span class="ruby-ivar">@department_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:department_id</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>.<span class="ruby-identifier">dup</span>
         <span class="ruby-ivar">@category_children</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:category_children</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword">false</span>
         <span class="ruby-ivar">@get_first_submenu</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:get_first_sub</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword">false</span>
         <span class="ruby-ivar">@the_page</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;1&#39;</span>

         <span class="ruby-ivar">@menu</span> = <span class="ruby-constant">Menu</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@category_id</span>).<span class="ruby-identifier">first</span>

         <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:top_menu</span>] <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-ivar">@get_first_submenu</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;true&#39;</span>)
           <span class="ruby-comment"># puts(&quot;top_menu id: #{@menu.menus[0].name}&quot;)</span>
           <span class="ruby-identifier">session</span>[<span class="ruby-value">:parent_menu_id</span>] = <span class="ruby-keyword">begin</span>
                                        <span class="ruby-ivar">@menu</span>.<span class="ruby-identifier">id</span>
                                      <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
                                        <span class="ruby-value">0</span>
                                      <span class="ruby-keyword">end</span>
           <span class="ruby-ivar">@menu</span> = <span class="ruby-ivar">@menu</span>.<span class="ruby-identifier">menus</span>[<span class="ruby-value">0</span>]
           <span class="ruby-ivar">@category_id</span> = <span class="ruby-keyword">begin</span>
                            <span class="ruby-ivar">@menu</span>.<span class="ruby-identifier">name</span>
                          <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
                            <span class="ruby-string">&#39;n/a&#39;</span>
                          <span class="ruby-keyword">end</span>

         <span class="ruby-keyword">end</span>

         <span class="ruby-comment"># @page_name=Menu.find(session[:parent_menu_id]).name rescue &quot;&quot;</span>
         <span class="ruby-keyword">begin</span>
           <span class="ruby-keyword">if</span> <span class="ruby-ivar">@category_children</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;true&#39;</span>
             <span class="ruby-ivar">@categories</span> = <span class="ruby-identifier">create_menu_lowest_child_list</span>(<span class="ruby-ivar">@category_id</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">false</span>) <span class="ruby-operator">+</span> [<span class="ruby-ivar">@category_id</span>]
             <span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;categories: #{@categories.inspect} &quot;</span>)
             <span class="ruby-ivar">@products_list</span> = <span class="ruby-constant">Product</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">product_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">tagged_with</span>(<span class="ruby-ivar">@categories</span>, <span class="ruby-identifier">any</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">on</span><span class="ruby-operator">:</span> <span class="ruby-value">:category</span>).<span class="ruby-identifier">tagged_with</span>(<span class="ruby-ivar">@department_id</span>, <span class="ruby-identifier">on</span><span class="ruby-operator">:</span> <span class="ruby-value">:department</span>)

           <span class="ruby-keyword">else</span>
             <span class="ruby-keyword">if</span> <span class="ruby-ivar">@category_id</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@department_id</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@category_id</span>.<span class="ruby-identifier">casecmp</span>(<span class="ruby-string">&#39;all&#39;</span>).<span class="ruby-identifier">zero?</span>
               <span class="ruby-ivar">@products_list</span> = <span class="ruby-constant">Product</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">product_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>)
             <span class="ruby-keyword">else</span>
               <span class="ruby-ivar">@products_list</span> = <span class="ruby-constant">Product</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">product_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">tagged_with</span>(<span class="ruby-ivar">@category_id</span>, <span class="ruby-identifier">on</span><span class="ruby-operator">:</span> <span class="ruby-value">:category</span>).<span class="ruby-identifier">tagged_with</span>(<span class="ruby-ivar">@department_id</span>, <span class="ruby-identifier">on</span><span class="ruby-operator">:</span> <span class="ruby-value">:department</span>)
             <span class="ruby-keyword">end</span>

           <span class="ruby-keyword">end</span>
           <span class="ruby-comment"># puts(&quot;=------------ product list found ---------------&quot;)</span>
           <span class="ruby-comment"># puts(@products_list.inspect)</span>
         <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
           <span class="ruby-comment">#  @products_list = Product.all</span>
         <span class="ruby-keyword">end</span>

         <span class="ruby-ivar">@product_ids</span> = <span class="ruby-ivar">@products_list</span>.<span class="ruby-identifier">pluck</span>(<span class="ruby-value">:id</span>)

         <span class="ruby-ivar">@product_count</span> = <span class="ruby-ivar">@products_list</span>.<span class="ruby-identifier">length</span>

         <span class="ruby-comment"># @products = Kaminari.paginate_array(@products).page(params[:page]).per(@products_per_page)</span>
         <span class="ruby-comment"># @products = Product.where(:id=&gt;@product_ids).order(&quot;product_ranking DESC&quot;).order(&quot;position ASC&quot;).order(&quot;created_at DESC&quot;).page(params[:page]).per(@products_per_page)</span>
         <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:show_all</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;true&#39;</span>
           <span class="ruby-ivar">@products</span> = <span class="ruby-constant">Product</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@product_ids</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;product_ranking DESC&#39;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;position ASC&#39;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;created_at DESC&#39;</span>)
         <span class="ruby-keyword">else</span>
           <span class="ruby-ivar">@products</span> = <span class="ruby-constant">Product</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@product_ids</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;product_ranking DESC&#39;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;position ASC&#39;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;created_at DESC&#39;</span>).<span class="ruby-identifier">page</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>]).<span class="ruby-identifier">per</span>(<span class="ruby-ivar">@products_per_page</span>)
         <span class="ruby-keyword">end</span>
         <span class="ruby-comment">#    @products = @products.page(params[:page]).per(@products_per_page)</span>

<span class="ruby-comment">#        puts(&quot;@product_ids: #{@product_ids},  @products_list: #{@products_list.count}, @products.count: #{@products.count}, @category_id: #{@category_id}, @department_id: #{@department_id} &quot;)</span>
         
         <span class="ruby-ivar">@product_first</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;1&#39;</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">*</span> <span class="ruby-ivar">@products_per_page</span> <span class="ruby-operator">-</span> (<span class="ruby-ivar">@products_per_page</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>))

         <span class="ruby-ivar">@product_last</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@products</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">:</span> ((<span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">*</span> <span class="ruby-ivar">@products_per_page</span>) <span class="ruby-operator">-</span> <span class="ruby-ivar">@products_per_page</span>) <span class="ruby-operator">+</span> <span class="ruby-ivar">@products</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@products</span>.<span class="ruby-identifier">length</span>

         <span class="ruby-identifier">system_action_template</span> = <span class="ruby-keyword">begin</span>
                                    (<span class="ruby-constant">Settings</span>.<span class="ruby-identifier">product_list_template_name</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;show_products&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;show_products-&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-constant">Settings</span>.<span class="ruby-identifier">product_list_template_name</span>)
                                  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
                                    <span class="ruby-string">&#39;show_products&#39;</span>
                                  <span class="ruby-keyword">end</span>
         <span class="ruby-ivar">@action_template</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:template</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">system_action_template</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:template</span>]

         <span class="ruby-ivar">@java_script_custom</span> = <span class="ruby-keyword">begin</span>
                                 <span class="ruby-ivar">@action_template</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;show_products&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@action_template</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;.js&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>
                               <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
                                 <span class="ruby-string">&#39;&#39;</span>
                               <span class="ruby-keyword">end</span>
         <span class="ruby-ivar">@style_sheet_custom</span> = <span class="ruby-keyword">begin</span>
                                 <span class="ruby-ivar">@action_template</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;show_products&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@action_template</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;.css&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>
                               <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
                                 <span class="ruby-string">&#39;&#39;</span>
                               <span class="ruby-keyword">end</span>

         <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
           <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@action_template</span> }
           <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">xml</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@products</span> }
         <span class="ruby-keyword">end</span>
       <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-toggle_cart" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">toggle_cart</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="toggle_cart-source">
            <pre><span class="ruby-comment"># File lib/silverweb_ecom/controller_extensions.rb, line 391</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">toggle_cart</span>
  <span class="ruby-identifier">find_cart</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">visable</span>
    <span class="ruby-identifier">hide_cart</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">show_cart</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

